pipeline {
  agent any

    parameters {
    string(name: 'COMPONENT', defaultValue: '', description: 'Which Component you would like to release?')
    string(name: 'TAG', defaultValue: '', description: 'Release Number')
    password(name: 'TOKEN', defaultValue: 'wk3beq6hjvqzb6rqd5ztfca6xtr2undvcils6j4hlccdnd5o6n4a', description: 'Token')
  }

  stages {

    stage('Create Tag') {
      steps {
        sh """
          git clone https://DevOps-Batches:${TOKEN}@dev.azure.com/DevOps-Batches/DevOps54/_git/${COMPONENT}.git
          git tag ${TAG}
          git push --tags
        """
      }
    }

    stage('Trigger CI for release') {
      steps {
        build wait: false, job: "${COMPONENT}-ci", parameters: [string(name: 'TAG', value: "${TAG}")]
      }
    }

  }
post {
    always {
      cleanWs()
    }
  }

}
